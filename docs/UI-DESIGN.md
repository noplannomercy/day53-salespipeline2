# SalesPipe CRM — UI 설계 문서

## 전체 레이아웃 구조

```
┌──────────────────────────────────────────────────────────────┐
│  Header (h-16, border-b)                                     │
│  [로고 + 앱명]    페이지 제목         [검색바]  [알림] [아바타] │
├────────────┬─────────────────────────────────────────────────┤
│  Sidebar   │  Main Content                                   │
│  (w-60)    │  (flex-1, p-6, overflow-y-auto)                 │
│  sticky    │                                                  │
│            │                                                  │
│  Dashboard │                                                  │
│  ──────    │                                                  │
│  Pipeline  │                                                  │
│  Kanban    │                                                  │
│  Deals     │                                                  │
│  ──────    │                                                  │
│  Contacts  │                                                  │
│  Companies │                                                  │
│  Leads     │                                                  │
│  ──────    │                                                  │
│  Activities│                                                  │
│  Emails    │                                                  │
│  ──────    │                                                  │
│  Reports   │                                                  │
│  Tags      │                                                  │
│  Members   │                                                  │
│  ──────    │                                                  │
│  Settings  │                                                  │
└────────────┴─────────────────────────────────────────────────┘
```

---

## 페이지별 레이아웃 구조

### 대시보드 (/dashboard)
```
[페이지 제목: 대시보드]

┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐
│ 진행 딜   │ │ 총 파이프 │ │이번달 Won│ │이번달Lost│
│  (건수)  │ │  라인 금액 │ │  (건+금액)│ │ (건+금액)│
└──────────┘ └──────────┘ └──────────┘ └──────────┘
SummaryCards × 4

┌────────────────────────────┐ ┌─────────────────────────┐
│ ForecastChart              │ │ ActivitySummary          │
│ 스테이지별 probability×value│ │ 이번 주 완료 / 예정 활동  │
│ (바 차트)                   │ │ (리스트)                 │
└────────────────────────────┘ └─────────────────────────┘

┌───────────────────────────────────────────────────────┐
│ RecentTimeline                                        │
│ 최근 딜 변경 이력 (타임라인 형식)                        │
└───────────────────────────────────────────────────────┘
```

### 목록 페이지 (deals, contacts, companies, leads, members, tags)
```
[페이지 제목]                              [+ 새로 만들기]

[검색 입력]  [필터1 ▼]  [필터2 ▼]  [필터3 ▼]   [정렬 ▼]

┌───────────────────────────────────────────────────────┐
│  DataTable                                            │
│  ┌──────┬──────┬──────┬──────┬──────┬────────────┐   │
│  │ 컬럼1 │ 컬럼2 │ 컬럼3 │ 컬럼4 │ 컬럼5 │  액션     │  │
│  ├──────┼──────┼──────┼──────┼──────┼────────────┤   │
│  │      │      │      │      │      │ [편집][삭제]│   │
│  └──────┴──────┴──────┴──────┴──────┴────────────┘   │
└───────────────────────────────────────────────────────┘

[← 이전]  1 / 5페이지  [다음 →]          총 48건
```

### 상세 페이지 (deals/:id, contacts/:id, companies/:id)
```
[← 목록으로]

[엔티티 제목/이름]           [상태 배지]    [편집] [삭제] [상태 전환]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  (딜 상세: StageProgress)
○ 유입  ●  제안  ○  협상  ○  계약  ○  완료
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[정보] [활동] [노트] [이메일] [첨부파일] [태그] [타임라인]  ← 탭

┌───────────────────────────────────────────────────────┐
│  탭 콘텐츠 영역                                         │
│                                                       │
└───────────────────────────────────────────────────────┘
```

### 파이프라인 관리 (/pipelines)
```
[파이프라인 관리]                          [+ 파이프라인 추가]

┌─────────────────────┐  ┌──────────────────────────────────┐
│ 파이프라인 목록       │  │ 스테이지 관리                     │
│                      │  │ [선택된 파이프라인 이름]           │
│ ● 영업 파이프라인 ★   │  │ ──────────────────────           │
│   제안 파이프라인     │  │ ⠿ [●] 1. 유입        10%  [편집] │
│   파트너 파이프라인   │  │ ⠿ [●] 2. 제안 중     30%  [편집] │
│                      │  │ ⠿ [●] 3. 협상        60%  [편집] │
│ [편집] [삭제]         │  │ ⠿ [●] 4. 계약 검토   80%  [편집] │
│                      │  │ ⠿ [●] 5. 완료       100%  [편집] │
│                      │  │                      [+ 스테이지]│
└─────────────────────┘  └──────────────────────────────────┘
```

### 칸반 보드 (/kanban)
```
[파이프라인: 영업 파이프라인 ▼]  [담당자 ▼] [우선도 ▼] [금액 범위]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  가로 스크롤
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ 유입   3건   │ │ 제안 중  5건 │ │ 협상    2건 │ │ 완료    8건 │
│ ₩15,000,000 │ │ ₩45,000,000 │ │ ₩30,000,000│ │ ₩80,000,000│
├─────────────┤ ├─────────────┤ ├─────────────┤ ├─────────────┤
│ ┌─────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │ │             │
│ │ 딜 제목  │ │ │ │ 딜 제목  │ │ │ │ 딜 제목  │ │ │             │
│ │ 회사명   │ │ │ │ 회사명   │ │ │ │ 회사명   │ │ │             │
│ │ ₩5M  🔴 │ │ │ │ ₩12M 🟠 │ │ │ │ ₩15M 🔴 │ │ │             │
│ │ [아바타] │ │ │ │ [아바타] │ │ │ │ [아바타] │ │ │             │
│ └─────────┘ │ │ └─────────┘ │ │ └─────────┘ │ │             │
│             │ │             │ │             │ │             │
│ [+ 딜 추가] │ │ [+ 딜 추가] │ │ [+ 딜 추가] │ │ [+ 딜 추가] │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
```

### 활동 관리 (/activities)
```
[활동 관리]              [리스트 | 캘린더] 토글    [+ 활동 추가]

[담당자 ▼]  [유형 ▼]

── 리스트 뷰 ──────────────────────────────────────────────────
[오늘] [이번 주] [예정] [완료]  탭

[ ] 📞 고객 콜 — 홍길동  |  오늘 14:00  |  [완료 체크]
[✓] 📧 제안서 발송      |  완료         |  [편집]
[ ] 🗓 킥오프 미팅       |  내일 10:00  |  [완료 체크]

── 캘린더 뷰 ─────────────────────────────────────────────────
[< 2026년 2월 >]

일  월  화  수  목  금  토
                          ...
    ...  [미팅] [콜]  ...
```

### 보고서 (/reports)
```
[파이프라인] [매출] [활동] [예측] [리드 소스]  탭

── 파이프라인 탭 ──────────────────────────────────────────────
[파이프라인 선택 ▼]

┌──────────────────────────────────────────┐
│  스테이지별 딜 수 / 금액 (BarChart)        │
└──────────────────────────────────────────┘

── 매출 탭 ────────────────────────────────────────────────────
┌──────────────────────────────────────────┐
│  월별 성사 금액 추이 (LineChart)            │
└──────────────────────────────────────────┘
```

---

## 공통 컴포넌트 목록

| 컴포넌트 | 위치 | 주요 Props | 용도 |
|---------|------|-----------|------|
| `DataTable` | common/ | `columns`, `data`, `onEdit`, `onDelete` | 범용 정렬/페이지네이션 테이블 |
| `Modal` | common/ | `isOpen`, `onClose`, `title`, `children` | Radix Dialog 래퍼 |
| `ConfirmDialog` | common/ | `isOpen`, `message`, `onConfirm`, `onCancel` | 삭제/위험 동작 확인 |
| `EmptyState` | common/ | `icon`, `message`, `actionLabel`, `onAction` | 데이터 없음 상태 |
| `PriorityBadge` | common/ | `priority` | low(회색)/medium(파랑)/high(주황)/urgent(빨강) |
| `StatusBadge` | common/ | `status`, `type` | 딜/리드 상태별 색상 뱃지 |
| `TagBadge` | common/ | `tag` | 태그 색상 + 이름 표시 |
| `MemberAvatar` | common/ | `member`, `size` | 아바타 이미지 or 이니셜 원형 |

---

## 페이지 간 네비게이션 흐름

```
/dashboard
  ├─ 딜 카드 클릭 ──────────────────→ /deals/:id
  ├─ 파이프라인 요약 클릭 ────────────→ /kanban?pipeline={id}
  └─ 활동 항목 클릭 ──────────────────→ /activities

/leads
  └─ [딜로 전환] 버튼 → ConvertDialog
      └─ 확인 → createDeal() → /deals/:id (새 딜)

/kanban
  ├─ 딜 카드 클릭 ──────────────────→ /deals/:id
  ├─ 드래그 드롭 → moveDealToStage() (페이지 이동 없음, 상태 갱신)
  └─ [+ 딜 추가] → DealForm 모달 (인라인, 페이지 이동 없음)

/deals
  └─ 행 클릭 ───────────────────────→ /deals/:id

/deals/:id
  ├─ 연락처 이름 클릭 ───────────────→ /contacts/:id
  ├─ 회사명 클릭 ───────────────────→ /companies/:id
  ├─ [Won] / [Lost] 버튼 → CloseDialog → 상태 업데이트 (페이지 내 처리)
  └─ StageProgress 클릭 → moveDealToStage() (페이지 내 처리)

/contacts
  └─ 행 클릭 ───────────────────────→ /contacts/:id

/contacts/:id
  └─ 연결 딜 클릭 ─────────────────→ /deals/:id

/companies
  └─ 행 클릭 ───────────────────────→ /companies/:id

/companies/:id
  ├─ 소속 연락처 클릭 ───────────────→ /contacts/:id
  └─ 연결 딜 클릭 ─────────────────→ /deals/:id
```

---

## 주요 UI 패턴

### 칸반 드래그 앤 드롭
- 구현: HTML5 Drag and Drop API (외부 라이브러리 없음)
- `DealCard`: `draggable="true"` + `onDragStart` → `DataTransfer.setData('dealId', id)`
- `KanbanColumn`: `onDragOver(e.preventDefault())` + `onDrop` → `DataTransfer.getData('dealId')`
- 드롭 완료: `moveDealToStage(dealId, columnStageId)` 호출 → 상태 업데이트
- 시각적 피드백:
  - 드래그 중인 카드: `opacity-50`
  - 드롭 가능 컬럼: `ring-2 ring-blue-400` (dragOver 시)

### 모달/폼 패턴
- 생성/수정은 항상 `Modal` 내 폼으로 처리 (페이지 이동 없음)
- 부모 컴포넌트에서 `isOpen`, `editTarget` state 관리
- 폼 내부 state: 모달 컴포넌트 내 `useState`
- 저장 흐름: 폼 제출 → 서비스 함수 → 성공 시 `onClose()` + `onSaved()` 콜백
- 취소/ESC/오버레이 클릭: 모달 닫기 (미저장 경고 없음)

### 필터 패턴
- 필터 값: 해당 page.tsx의 `useState`
- 필터 적용: 서비스 함수에 `filters` 객체 전달 (클라이언트 사이드 필터링)
- URL 쿼리 파라미터 미사용
- 필터 초기화: 각 필터 셀렉트에 "전체" 옵션 포함

### 상태 전이 패턴
- 리드 상태: `new → contacted → qualified / unqualified` (LeadForm 내 드롭다운)
- Qualified → 딜 전환: `ConvertDialog` (파이프라인/스테이지 선택 후 `convertLeadToDeal`)
- 딜 상태: `open → won / lost` (CloseDialog — Lost 시 `lostReason` 텍스트 입력 필수)
- 딜 스테이지 이동: StageProgress 클릭 또는 칸반 드래그

### 딜 상세 탭 (7탭)
| 탭 | 콘텐츠 | 액션 |
|----|--------|------|
| 정보 | 딜 필드 인라인 편집 | 저장 |
| 활동 | ActivityList (dealId 필터) | + 활동 추가 |
| 노트 | 노트 카드 목록 | + 노트 작성 |
| 이메일 | EmailList (dealId 필터) | + 이메일 작성 |
| 첨부파일 | 파일 메타 목록 | + 파일 추가 |
| 태그 | TagBadge 목록 | + 태그 추가 / × 제거 |
| 타임라인 | Activity + Note + Email 통합, createdAt 시간순 정렬 | - |

### 차트 패턴 (Recharts)
| 차트 | 컴포넌트 | 데이터 |
|------|---------|--------|
| BarChart | PipelineReport, ActivityReport, ForecastChart | 스테이지별/멤버별 집계 |
| LineChart | SalesReport | 월별 성사 금액 |
| PieChart | LeadSourceReport | 소스별 전환율 |
| 공통 설정 | `ResponsiveContainer` 래핑, `Tooltip`, `Legend` | - |
| 색상 | shadcn/ui CSS 변수 참조 또는 Tailwind 팔레트 고정 값 | - |

### EmptyState 패턴
- 데이터가 0건일 때 DataTable 대신 표시
- 구성: 아이콘 + 설명 메시지 + CTA 버튼 (예: "첫 딜을 추가해보세요")
- 필터 적용 시 0건: "검색 결과 없음" + 필터 초기화 버튼

### 다크모드
- `app/layout.tsx`의 `<html>` 태그에 `dark` 클래스 토글
- 설정값: `sp_settings.darkMode` (boolean)
- Tailwind `dark:` 변형 활용
